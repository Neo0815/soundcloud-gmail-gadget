<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs
    title="SoundCloud"
    title_url="http://soundcloud.com/"
    description="Tracks from this email"
    height="20"
    author="Eric Wahlforss"
    author_email="eric@soundcloud.com"
    author_location="Berlin, Germany">

    <Icon type="image/gif">http://sc.warteschlange.de/sc-icon.gif</Icon>

    <Require feature="dynamic-height"/>
    <Require feature="google.contentmatch">
      <Param name="extractors">
        google.com:HttpLinkExtractor
      </Param>
    </Require>
  </ModulePrefs>
  <Content type="html" view="card">
    <![CDATA[
    <style type="text/css">
      body {
        background: transparent;
        font-size: 13px;
        font-family: arial, sans-serif;
        color: #55688A;
      }
      .header {
        margin: 0px 0px 3px 3px;
      }
      ul {
        padding: 0;
        margin: 0;
      }
      li {
        list-style-type: none;
        padding: 0 0 10px 0;
        margin: 0;
        display: none;
      }
      a {
        color: #55688A;
        display: none;
      }
    </style>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://sc.warteschlange.de/sc-gmail.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function() {
        $(document.body).scGMail( google.contentmatch.getContentMatches(),
          { callback: function(list){
              var heights = [15, 15], cnt = 0, scnt = 0, linePadding = 15;
              $.each( list, function(url, height){
                if( cnt < 3) {
                  heights[0] += height + linePadding;
                }
                heights[1] += height + linePadding;
                cnt += 1;
              });
              $('li').slice(0,3).show();
              gadgets.window.adjustHeight(heights[0]);
              if( cnt > 3 ) {
                $('a')
                 .click( function() {
                    gadgets.window.adjustHeight(heights[(scnt+=1) % 2]);
                    $('li').slice(3).add('a').toggle();
                  })
                 .filter('.show')
                 .html('Show ' + (cnt - 3) + ' more')
                 .show();
              }
            }
          }
        );
      });
    </script>
    <body>
      <div class="header">
        <a href="#" class="show">Show more</a>
        <a href="#">Hide</a>
      </div>
    </body>
    ]]>
  </Content>
</Module>